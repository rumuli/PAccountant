@page "/SupportTickets"
@using Domain.Entities
@using Application.Services.SupportTickets

@inject ISupportTicketService SupportTicketService      

<PageTitle>Support Tickets</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="py-8">
    
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-6">
        <MudText Typo="Typo.h4" Class="font-weight-bold">
            Support Tickets
        </MudText>

        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   StartIcon="@Icons.Material.Filled.Add"
                   Href="/SupportTickets/create">
            Add Support Ticket
        </MudButton>
    </div>

    <!-- GRID VIEW -->
    <MudDataGrid T="SupportTicket"
                 Items="@_SupportTickets"
                 Hover="true"
                 Striped="true"
                 Bordered="true"
                 Dense="true"
                 Filterable="true"
                 SortMode="SortMode.Multiple"
                 Class="elevation-1">

        <Columns>

            <PropertyColumn Property="x => x.Id"
                            Title="ID"
                            Sortable="true" />

            <PropertyColumn Property="x => x.CustomerId"
                            Title="Customer ID"
                            Sortable="true" />

            <PropertyColumn Property="x => x.Subject"
                            Title="Subject"
                            Sortable="true" />

            <PropertyColumn Property="x => x.Description"
                            Title="Description" />

            <!-- Status Column -->
            <TemplateColumn Title="Status">
                <CellTemplate>
                    <MudChip T="string"
                             Color="@GetStatusColor(context.Item.IsActive)"
                             Text="@(context.Item.IsActive ? "Active" : "Inactive")"
                             Variant="Variant.Filled" />
                </CellTemplate>
            </TemplateColumn>

            <PropertyColumn Property="x => x.CreatedAt"
                            Title="Created Date"
                            Format="MM/dd/yyyy"
                            Sortable="true" />

            <!-- Actions -->
            <TemplateColumn Title="Actions">
                <CellTemplate>

                    <MudIconButton Icon="@Icons.Material.Filled.Info"
                                   Color="Color.Info"
                                   Size="Size.Small"
                                   Href="@($"/SupportTickets/{context.Item.Id}")"
                                   Title="View Details" />

                    <MudIconButton Icon="@Icons.Material.Filled.Edit"
                                   Color="Color.Primary"
                                   Size="Size.Small"
                                   Href="@($"/SupportTickets/edit/{context.Item.Id}")"
                                   Title="Edit Support Ticket" />

                </CellTemplate>
            </TemplateColumn>

        </Columns>

    </MudDataGrid>

</MudContainer>

@code {

    List<SupportTicket> _SupportTickets = new();

    protected override void OnInitialized()
    {
        _SupportTickets = SupportTicketService.GetAllSupportTickets();
    }

    private Color GetStatusColor(bool isActive)
    {
        return isActive ? Color.Success : Color.Error;
    }
}
