@page "/Campaigns/Edit/{Id:int}"
@using Application.Services.Campaigns
@inject ICampaignService CampaignService
@inject NavigationManager NavigationManager
@rendermode InteractiveServer
@using Application.DTO
@using System.ComponentModel.DataAnnotations

<PageTitle>Edit Campaign</PageTitle>

<!-- MudContainer: Responsive container with max-width constraint -->
<MudContainer MaxWidth="MaxWidth.Small" Class="py-8">
    
    <!-- Header Section with Title and Back Button -->
    <div class="d-flex justify-content-between align-items-center mb-6">
        <MudText Typo="Typo.h4" Class="font-weight-bold">Edit Campaign</MudText>
        <MudButton 
            Variant="Variant.Text" 
            Color="Color.Secondary" 
            StartIcon="@Icons.Material.Filled.ArrowBack"
            Href="/Campaigns">
            Back to List
        </MudButton>
    </div>

    <!-- MudCard: Main form container with elevation shadow -->
    <MudCard Class="elevation-1">
        <MudCardContent>
            @if (Model != null)
            {
                <!-- EditForm: Blazor's form validation framework -->
                <EditForm Model="Model" OnValidSubmit="OnValidSubmit">
                    <!-- DataAnnotationsValidator: Enables server-side validation based on DTO attributes -->
                    <DataAnnotationsValidator />
                    
                    <!-- Validation Summary Alert -->
                    <ValidationSummary />

                    <!-- Title Field -->
                    <MudTextField 
                        T="string"
                        Label="Campaign Title"
                        Variant="Variant.Outlined"
                        @bind-Value="Model.Title"
                        Placeholder="Enter campaign title"
                        HelperText="Title of the campaign"
                        For="@(() => Model.Title)"
                        Class="mb-4" />
                    <ValidationMessage For="@(() => Model.Title)" />

                    <!-- Description Field -->
                    <MudTextField 
                        T="string"
                        Label="Campaign Description"
                        Variant="Variant.Outlined"
                        @bind-Value="Model.Description"
                        Placeholder="Enter campaign description"
                        HelperText="Description of the campaign"
                        For="@(() => Model.Description)"
                        Lines="4"
                        Class="mb-4" />
                    <ValidationMessage For="@(() => Model.Description)" />

                    <!-- Budget Field -->
                    <MudNumericField 
                        T="decimal"
                        Label="Campaign Budget"
                        Variant="Variant.Outlined"
                        @bind-Value="Model.Budget"
                        Placeholder="Enter campaign budget"
                        HelperText="Budget amount of the campaign"
                        For="@(() => Model.Budget)"
                        Class="mb-6" />
                    <ValidationMessage For="@(() => Model.Budget)" />

                    <!-- Action Buttons -->
                    <div class="d-flex gap-3 justify-content-center mt-6">
                        <!-- Save Button: Updates campaign on valid form submission -->
                        <MudButton 
                            Variant="Variant.Filled" 
                            Color="Color.Primary" 
                            Size="Size.Medium"
                            StartIcon="@Icons.Material.Filled.Save"
                            ButtonType="ButtonType.Submit">
                            Save Changes
                        </MudButton>
                        
                        <!-- Cancel Button: Returns to campaign list without saving -->
                        <MudButton 
                            Variant="Variant.Outlined" 
                            Color="Color.Default" 
                            Size="Size.Medium"
                            StartIcon="@Icons.Material.Filled.Cancel"
                            Href="/Campaigns">
                            Cancel
                        </MudButton>
                    </div>
                    
                </EditForm>
            }
            else
            {
                <MudProgressCircular Indeterminate="true" />
                <MudText Class="mt-3">Loading campaign...</MudText>
            }

        </MudCardContent>
    </MudCard>
</MudContainer>

@code{
    [Parameter]
    public int Id { get; set; }

    private UpdateCampaignDTO? Model {get; set; } = new();

    private bool loaded;
//retrieve the campaign
    protected override void OnParametersSet()
    {
        var campaign = CampaignService.GetCampaignById(Id);
        if (campaign != null)
        {
            Model = new UpdateCampaignDTO
            {
              Title = campaign.Title ?? "",
              Description = campaign.Description ?? "",
              Budget = campaign.Budget 
            
                
            };
            loaded = true;
        }
    }

    private void OnValidSubmit()
    {
        if (Model != null)
        {
            CampaignService.UpdateCampaign(Id, Model);
            NavigationManager.NavigateTo("/Campaigns");
        }
    }
}