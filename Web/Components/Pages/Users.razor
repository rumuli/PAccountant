@page "/Users"
@using Application.DTO
@using Application.Interfaces.Users
@using Domain.Entities
@using Application.Services.Users
@inject ISnackbar Snackbar



@inject  IIdentityService IdentityService

<PageTitle>Users</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="py-8">
    <!-- Header and Add usersmer Section -->
    <MudGrid Spacing="3" Class="mb-6">
        <!-- Left Column: Header -->
        <MudItem xs="12" sm="12" md="8">
            <MudText Typo="Typo.h4" Class="font-weight-bold">Users</MudText>
        </MudItem>
        
        <!-- Right Column: Add usersmer Button -->
        <MudItem xs="12" sm="12" md="4" Class="d-flex align-items-center justify-content-end">
            <MudButton 
                Variant="Variant.Filled" 
                Color="Color.Primary" 
                StartIcon="@Icons.Material.Filled.PersonAdd"
                Href="/RegisterUser">
                Create User
            </MudButton>
        </MudItem>
    </MudGrid>

    <!-- Users Table -->
    <MudTable Items="@users" Hover="true" Striped="true" Bordered="true" Class="elevation-1">
        <HeaderContent>
        
            <MudTh>First Name </MudTh>
            <MudTh>Last Name</MudTh>
            <MudTh>Email</MudTh>
            <MudTh>Phone Number</MudTh>
            <MudTh>Email Verified</MudTh>
            <MudTh>Created At</MudTh>
            <MudTh Style="text-align:center">Actions</MudTh>
        </HeaderContent>
        <RowTemplate>
        
            <MudTd DataLabel="Name">@context.FirstName</MudTd>
            <MudTd DataLabel="Name">@context.LastName</MudTd>
            <MudTd DataLabel="Email">@context.Email</MudTd>
            <MudTd DataLabel="Phone">@context.PhoneNumber</MudTd>
            <MudTd DataLabel="EmailConfirmed">
                <MudChip T="string" Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Success" Variant="Variant.Filled" Size="Size.Small">
                    Verified
                </MudChip>
            </MudTd>
            
               
            <MudTd DataLabel="Created At">@context.CreatedAt.ToString("dd MMM yyyy")</MudTd>
            <MudTd Style="text-align:center">
                <!-- Details Icon Button -->
                <MudIconButton 
                    Icon="@Icons.Material.Filled.Info" 
                    Color="Color.Info" 
                    Size="Size.Small"
                    Href="@($"/Users/{context.Id}")"
                    Title="View Details" />
                
                <!-- Edit Icon Button -->
                <MudIconButton 
                    Icon="@Icons.Material.Filled.Edit" 
                    Color="Color.Primary" 
                    Size="Size.Small"
                    Href="@($"/Users/edit/{context.Id}")"
                    Title="Edit User" />
            </MudTd>
        </RowTemplate>
    </MudTable>
</MudContainer>
    

@code {
    private List<UserDetailDTO> users = new List<UserDetailDTO>();

        private bool loading = false;


        protected override async Task OnInitializedAsync()
        {
            await LoadUsers();
        }

        private async Task LoadUsers()
        {
            loading = true;
            try
            {
                users = await IdentityService.GetAllUsers();
            }
            catch (Exception ex)
            {
                Snackbar.Add($"Error loading users: {ex.Message}", Severity.Error);
            }
            finally
            {
                loading = false;
            }
        }
    }