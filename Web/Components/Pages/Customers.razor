@page "/Customers"
@using Domain.Entities
@using Application.Services.Customers
@using MudBlazor
@inject ICustomerService CustomerService
@inject IDialogService DialogService

<PageTitle>Customers</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="py-8">

    <!-- HEADER -->
    <MudGrid Spacing="3" Class="mb-6">
        <MudItem xs="12" md="8">
            <MudText Typo="Typo.h4" Class="font-weight-bold">
                Customers
            </MudText>
        </MudItem>

        <MudItem xs="12" md="4" Class="d-flex align-items-center justify-content-end">
            <MudButton Variant="Variant.Filled"
                       Color="Color.Primary"
                       StartIcon="@Icons.Material.Filled.PersonAdd"
                       OnClick="OpenCreateDialog">
                Create Customer
            </MudButton>
        </MudItem>
    </MudGrid>

    <!-- GRID VIEW -->
    <MudDataGrid T="Customer"
                 Items="@_customers"
                 Hover="true"
                 Striped="true"
                 Bordered="true"
                 Dense="true"
                 Filterable="true"
                 SortMode="SortMode.Multiple"
                 Class="elevation-1">

        <Columns>

            <PropertyColumn Property="x => x.Id" Title="ID" Sortable="true" />
            <PropertyColumn Property="x => x.Name" Title="Name" Sortable="true" />
            <PropertyColumn Property="x => x.Email" Title="Email" />
            <PropertyColumn Property="x => x.Phone" Title="Phone" />
            <PropertyColumn Property="x => x.Address" Title="Address" />
            <PropertyColumn Property="x => x.City" Title="City" Sortable="true" />

            <TemplateColumn Title="Status">
                <CellTemplate>
                    <MudChip T="string"
                             Color="@(context.Item.IsActive ? Color.Success : Color.Error)"
                             Text="@(context.Item.IsActive ? "Active" : "Inactive")"
                             Variant="Variant.Filled"
                             Size="Size.Small" />
                </CellTemplate>
            </TemplateColumn>

            <PropertyColumn Property="x => x.CreatedAt"
                            Title="Created At"
                            Format="dd MMM yyyy"
                            Sortable="true" />

            <TemplateColumn Title="Actions">
                <CellTemplate>

                    <MudIconButton Icon="@Icons.Material.Filled.Info"
                                   Color="Color.Info"
                                   Size="Size.Small"
                                   Href="@($"/Customers/{context.Item.Id}")" />

                    <MudIconButton Icon="@Icons.Material.Filled.Edit"
                                   Color="Color.Primary"
                                   Size="Size.Small"
                                   Href="@($"/Customers/edit/{context.Item.Id}")" />

                </CellTemplate>
            </TemplateColumn>

        </Columns>

    </MudDataGrid>

</MudContainer>

@code {

     private List<Customer> _customers = new();

    protected override async Task OnInitializedAsync()
    {
        _customers = CustomerService.GetAllCustomers();
    }

      
    private void OpenCreateDialog()
    {
        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Small, FullWidth = true };
        DialogService.Show<CreateCustomerDialog>("", options);  
}

}
